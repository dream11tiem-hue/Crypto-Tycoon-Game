<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Coin AI Simulator Pro | OfficialAyanEdits</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #22c55e;
            --bg: #030712;
            --glass: rgba(17, 24, 39, 0.85);
            --border: rgba(255, 255, 255, 0.08);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: #f3f4f6;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .terminal-font { font-family: 'JetBrains Mono', monospace; }
        .glass { background: var(--glass); backdrop-filter: blur(20px); border: 1px solid var(--border); }
        .neon-glow { color: var(--primary); text-shadow: 0 0 10px rgba(34, 197, 94, 0.5); }
        .neon-border { border: 1px solid var(--primary); box-shadow: 0 0 15px rgba(34, 197, 94, 0.2); }
        
        /* Custom Scrollbar */
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.1); border-radius: 10px; }

        /* Animations */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .animate-up { animation: slideUp 0.5s ease-out forwards; }
        
        .tab-active { background: var(--primary); color: white; box-shadow: 0 4px 20px rgba(34, 197, 94, 0.4); }
        
        /* Loading Scanline */
        @keyframes scan { 0% { top: -100%; } 100% { top: 100%; } }
        .scanline::after {
            content: ""; position: absolute; width: 100%; height: 3px;
            background: rgba(34, 197, 94, 0.1); animation: scan 4s linear infinite;
        }
    </style>
</head>
<body class="h-screen flex flex-col scanline">

    <div id="boot-overlay" class="fixed inset-0 z-[1000] bg-black flex flex-col items-center justify-center p-8 terminal-font">
        <div class="w-full max-w-lg space-y-4">
            <div id="boot-logs" class="text-green-500 text-[10px] h-32 overflow-hidden flex flex-col-reverse opacity-70"></div>
            <div class="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                <div id="boot-progress" class="h-full bg-green-500 w-0 transition-all duration-300"></div>
            </div>
            <p id="boot-status" class="text-center text-[10px] text-gray-500 uppercase tracking-widest animate-pulse">Establishing Secure Link...</p>
        </div>
    </div>

    <header class="glass sticky top-0 z-[100] px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-white/5">
        <div class="flex items-center gap-4 w-full md:w-auto">
            <div class="relative group">
                <div class="w-14 h-14 rounded-2xl bg-gradient-to-br from-green-600 to-emerald-900 border border-white/20 flex items-center justify-center font-black text-2xl shadow-2xl transition-transform group-hover:scale-110">A</div>
                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-4 border-slate-950 rounded-full"></div>
            </div>
            <div>
                <h2 id="p-name-hud" class="text-xl font-extrabold tracking-tight">GUEST_TRADER</h2>
                <div class="flex items-center gap-3 text-[10px] text-gray-500 font-bold uppercase tracking-widest">
                    <span id="p-rank-hud" class="text-green-500">Tier: Rookie</span>
                    <span class="w-1 h-1 bg-gray-700 rounded-full"></span>
                    <span id="p-streak-hud">Streak: 0 Days</span>
                </div>
            </div>
        </div>
        <div class="flex items-center gap-6 w-full md:w-auto justify-between md:justify-end">
            <div class="text-right">
                <p class="text-[9px] text-gray-600 font-bold uppercase tracking-widest">Net Profit Value</p>
                <p id="p-profit-hud" class="text-xs font-bold text-green-400">+$0.00</p>
            </div>
            <div class="px-6 py-3 rounded-2xl bg-white/5 border border-white/10 flex flex-col items-end">
                <p class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Available Balance</p>
                <p id="p-wallet-hud" class="text-3xl font-black neon-glow">$0.00</p>
            </div>
        </div>
    </header>

    <nav class="flex p-2 gap-2 glass border-b border-white/5 scroller overflow-x-auto">
        <button onclick="changeView('chat')" id="nav-chat" class="tab-active flex-grow min-w-[120px] py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" stroke-width="2"/></svg>
            Manager
        </button>
        <button onclick="changeView('market')" id="nav-market" class="flex-grow min-w-[120px] py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" stroke-width="2"/></svg>
            Market
        </button>
        <button onclick="changeView('jobs')" id="nav-jobs" class="flex-grow min-w-[120px] py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-width="2"/></svg>
            Job Board
        </button>
        <button onclick="changeView('leader')" id="nav-leader" class="flex-grow min-w-[120px] py-4 rounded-2xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138z" stroke-width="2"/></svg>
            Rankings
        </button>
    </nav>

    <main class="flex-grow relative overflow-hidden">
        
        <section id="view-chat" class="absolute inset-0 flex flex-col animate-up">
            <div id="chat-flow" class="flex-grow overflow-y-auto p-6 space-y-6 scroller pb-40">
                <div class="max-w-[85%] glass p-6 rounded-3xl rounded-tl-none border-l-4 border-green-500 shadow-2xl">
                    <p class="text-[9px] font-black text-green-500 uppercase mb-2">Manager Online</p>
                    <div class="text-sm leading-relaxed" id="greeting-box">Initializing AI link with custom model...</div>
                </div>
            </div>

            <div class="p-6 bg-gradient-to-t from-bg via-bg/95 to-transparent">
                <div class="max-w-4xl mx-auto flex items-center glass p-2 rounded-[2.5rem] border border-white/10 shadow-3xl">
                    <button onclick="openSettings()" class="p-4 text-gray-500 hover:text-white transition-colors">‚öôÔ∏è</button>
                    <input type="text" id="ai-input" placeholder="Type command or message..." class="flex-grow bg-transparent px-5 py-4 outline-none text-sm font-medium">
                    <button id="ai-send" class="bg-primary hover:bg-emerald-500 text-white p-4 rounded-[1.8rem] transition-all shadow-xl active:scale-95">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                    </button>
                </div>
            </div>
        </section>

        <section id="view-market" class="absolute inset-0 hidden overflow-y-auto p-6 bg-slate-950 animate-up">
            <h3 class="text-3xl font-black mb-8 tracking-tighter">LIQUIDITY_MARKET</h3>
            <div id="market-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </section>

        <section id="view-jobs" class="absolute inset-0 hidden overflow-y-auto p-6 bg-black animate-up">
            <div class="p-8 rounded-[3rem] bg-yellow-900/10 border border-yellow-700/20 mb-8">
                <h3 class="text-2xl font-black text-yellow-500 mb-2">Job Board</h3>
                <p class="text-sm text-gray-400">Zero balance? Use the terminal to promote whale tokens and earn passive commission. AI handles all payouts automatically.</p>
            </div>
            <div id="job-list" class="space-y-4"></div>
        </section>

        <section id="view-leader" class="absolute inset-0 hidden overflow-y-auto p-6 bg-[#02040a] animate-up">
            <h3 class="text-3xl font-black text-center mb-10 tracking-tighter uppercase">Global Top 100</h3>
            <div id="leader-feed" class="max-w-3xl mx-auto space-y-3"></div>
        </section>
    </main>

    <div id="modal-settings" class="fixed inset-0 z-[2000] bg-black/95 hidden items-center justify-center p-6 backdrop-blur-3xl">
        <div class="glass p-10 rounded-[3rem] w-full max-w-lg border-2 border-primary/20 animate-up">
            <h3 class="text-3xl font-black mb-2">TERMINAL CONFIG</h3>
            <p class="text-xs text-gray-500 mb-10 font-bold uppercase tracking-widest">Secure Hardware Configuration</p>
            
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-3 block">OpenRouter API Key</label>
                    <input type="password" id="cfg-key" class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-primary transition-all text-sm font-bold" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-3 block">Custom Model Name (Manual Type)</label>
                    <input type="text" id="cfg-model" class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-primary transition-all text-sm font-bold" placeholder="e.g. deepseek/deepseek-r1:free">
                    <p class="text-[9px] text-gray-600 mt-2 italic">*Type any OpenRouter model ID exactly as listed.</p>
                </div>
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-3 block">Player Handle</label>
                    <input type="text" id="cfg-name" class="w-full bg-white/5 border border-white/10 p-5 rounded-2xl outline-none focus:border-primary transition-all text-sm font-bold" placeholder="AYAN_GUEST">
                </div>

                <div class="pt-6">
                    <button onclick="saveSettings()" class="w-full bg-primary hover:bg-emerald-400 py-5 rounded-3xl font-black text-sm uppercase tracking-widest shadow-2xl transition-all active:scale-95">Establish Secure Link</button>
                    <button onclick="closeSettings()" class="w-full py-4 text-xs text-gray-600 font-bold uppercase hover:text-white transition-colors">Abort Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- FIREBASE INITIALIZATION ---
        const firebaseConfig = {
            apiKey: "AIzaSyAAC-fGe6dO1nIQ1LCg7f-Bk-spQ2IAvEs",
            authDomain: "tubevideo-d3bf7.firebaseapp.com",
            databaseURL: "https://tubevideo-d3bf7-default-rtdb.firebaseio.com",
            projectId: "tubevideo-d3bf7",
            storageBucket: "tubevideo-d3bf7.firebasestorage.app",
            messagingSenderId: "327518146396",
            appId: "1:327518146396:web:e88298f8f049fdb73ebb99"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- GLOBAL STATE ---
        let state = {
            p: {
                name: localStorage.getItem('ay_name') || "AYAN_GUEST",
                wallet: parseFloat(localStorage.getItem('ay_wallet')) || 1000.00,
                streak: parseInt(localStorage.getItem('ay_streak')) || 0,
                lastLogin: parseInt(localStorage.getItem('ay_last')) || 0,
                isBankrupt: false
            },
            cfg: {
                key: localStorage.getItem('ay_key') || "",
                model: localStorage.getItem('ay_model') || "deepseek/deepseek-r1:free"
            },
            market: [
                {id: 'ayan_off', name: 'Ayan Official', price: 154.20, change: 5.2},
                {id: 'a_coin', name: 'A-Token', price: 0.98, change: -1.5}
            ]
        };

        // --- BOOTING SEQUENCE ---
        window.onload = () => {
            const logs = document.getElementById('boot-logs');
            const progress = document.getElementById('boot-progress');
            const bootLines = ["DECRYPTING_PACKETS...", "CONNECTING_FIREBASE...", "LOADING_REWARDS_ENGINE...", "READY_FOR_HANDSHAKE."];
            
            let i = 0;
            const timer = setInterval(() => {
                const line = document.createElement('p');
                line.innerText = `[SUCCESS] ${bootLines[i]}`;
                logs.prepend(line);
                i++;
                progress.style.width = (i / bootLines.length) * 100 + '%';
                
                if(i >= bootLines.length) {
                    clearInterval(timer);
                    setTimeout(() => {
                        document.getElementById('boot-overlay').classList.add('hidden');
                        initGame();
                    }, 500);
                }
            }, 300);
        };

        function initGame() {
            updateHUD();
            processDailyReward();
            syncLeaderboard();
            startMarketFeed();
            if(!state.cfg.key) openSettings();
            addAI("Welcome Boss. Handshake successful with **" + state.cfg.model + "**. Capital verified at **$" + state.p.wallet + "**. Ready for market analysis.");
        }

        function updateHUD() {
            const w = document.getElementById('p-wallet-hud');
            w.innerText = `$${state.p.wallet.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('p-name-hud').innerText = state.p.name.toUpperCase();
            document.getElementById('p-streak-hud').innerText = `Streak: ${state.p.streak} Days`;
            
            localStorage.setItem('ay_wallet', state.p.wallet);
            localStorage.setItem('ay_name', state.p.name);

            // Sync Firebase Rankings
            db.ref('global_ranking/' + state.p.name).set({
                name: state.p.name,
                wallet: state.p.wallet,
                streak: state.p.streak
            });
            
            if(state.p.wallet <= 0) { state.p.isBankrupt = true; w.classList.add('text-red-500'); }
            else { state.p.isBankrupt = false; w.classList.remove('text-red-500'); }
        }

        // --- CORE GAME ENGINE ---
        function changeView(id) {
            ['chat', 'market', 'jobs', 'leader'].forEach(t => {
                document.getElementById('view-' + t).classList.add('hidden');
                document.getElementById('nav-' + t).classList.remove('tab-active');
                document.getElementById('nav-' + t).classList.add('text-gray-500');
            });
            document.getElementById('view-' + id).classList.remove('hidden');
            document.getElementById('nav-' + id).classList.add('tab-active');
            document.getElementById('nav-' + id).classList.remove('text-gray-500');
            
            if(id === 'market') renderMarket();
            if(id === 'leader') renderLeaderboard();
        }

        async function triggerAI() {
            const input = document.getElementById('ai-input');
            const msg = input.value.trim();
            if(!msg || !state.cfg.key) return;

            if(msg.startsWith('/')) { handleCommands(msg); input.value = ''; return; }

            addChat('user', msg);
            input.value = '';

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: { "Authorization": `Bearer ${state.cfg.key}`, "Content-Type": "application/json" },
                    body: JSON.stringify({
                        model: state.cfg.model,
                        messages: [
                            { role: "system", content: `You are the Manager for ${state.p.name}. Wallet: $${state.p.wallet}. 
                            RULES: 
                            1. Never use 'Aggressive'. Use 'Intense' or 'Hard'. 
                            2. To list coin: $10M + 1000 AyanOfficial.
                            3. If bankrupt, push Job Board tasks.
                            4. Manual AI Model Link: ${state.cfg.model} is active.
                            5. Anti-cheat is absolute.` },
                            { role: "user", content: msg }
                        ]
                    })
                });
                const data = await response.json();
                addAI(data.choices[0].message.content);
            } catch (err) {
                addAI("‚ùå [SYSTEM_ALERT] SECURE_HANDSHAKE_FAILED. Check API/Model name.");
            }
        }

        function handleCommands(cmd) {
            if(cmd.includes('/profile')) {
                const html = `<div class="p-6 glass rounded-3xl border border-white/10 shadow-3xl">
                    <h4 class="text-xl font-black mb-4">PROFILE_DOSSIER: ${state.p.name}</h4>
                    <div class="space-y-2 text-xs">
                        <p class="flex justify-between"><span>Capital:</span> <span class="text-green-400 font-bold">$${state.p.wallet}</span></p>
                        <p class="flex justify-between"><span>Streak:</span> <span>${state.p.streak} Days</span></p>
                        <p class="flex justify-between"><span>Status:</span> <span class="${state.p.isBankrupt ? 'text-red-500' : 'text-green-500'}">${state.p.isBankrupt ? 'BROKE' : 'OPERATIONAL'}</span></p>
                    </div>
                </div>`;
                addChat('ai', html, true);
            } else if(cmd.includes('/settings')) { openSettings(); }
        }

        function addChat(role, text, isHTML = false) {
            const flow = document.getElementById('chat-flow');
            const div = document.createElement('div');
            div.className = `animate-up flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            const content = isHTML ? text : marked.parse(text);
            div.innerHTML = `<div class="max-w-[85%] ${role === 'user' ? 'bg-primary/20 border-r-4 border-primary rounded-tr-none' : 'glass border-l-4 border-primary rounded-tl-none'} p-5 rounded-3xl shadow-xl">
                <p class="text-[9px] font-black uppercase mb-2 ${role === 'user' ? 'text-right text-emerald-400' : 'text-green-500'}">${role === 'user' ? state.p.name : 'MANAGER'}</p>
                <div class="text-sm prose prose-invert">${content}</div>
            </div>`;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
        }

        function addAI(t) { addChat('ai', t); }

        // --- GAME MECHANICS ---
        function processDailyReward() {
            const now = Date.now();
            const day = 24 * 60 * 60 * 1000;
            if(now - state.p.lastLogin > day) {
                state.p.streak = (state.p.streak >= 7) ? 1 : state.p.streak + 1;
                const bonus = state.p.streak * 1000;
                state.p.wallet += bonus;
                state.p.lastLogin = now;
                localStorage.setItem('ay_streak', state.p.streak);
                localStorage.setItem('ay_last', now);
                addAI(`üéÅ **STREAK_UNLOCKED**: Day ${state.p.streak}. Bonus of **$${bonus}** added.`);
                updateHUD();
            }
        }

        function startMarketFeed() {
            setInterval(() => {
                state.market.forEach(c => {
                    const delta = (Math.random() * 4) - 2;
                    c.price += (c.price * (delta/100));
                    c.change = delta.toFixed(2);
                });
                if(!document.getElementById('view-market').classList.contains('hidden')) renderMarket();
            }, 5000);
        }

        function renderMarket() {
            const grid = document.getElementById('market-list');
            grid.innerHTML = '';
            state.market.forEach(c => {
                grid.innerHTML += `<div class="glass p-6 rounded-[2.5rem] border border-white/5 animate-up">
                    <div class="flex justify-between items-start mb-6"><div class="w-12 h-12 rounded-2xl bg-white/5 flex items-center justify-center font-black border border-white/10 text-xl">${c.id[0].toUpperCase()}</div>
                    <div class="text-right"><p class="text-sm font-black ${c.change >= 0 ? 'text-green-400' : 'text-red-400'}">${c.change >= 0 ? '+' : ''}${c.change}%</p><p class="text-[9px] text-gray-600 font-bold uppercase">Volatility</p></div></div>
                    <h4 class="text-xs font-bold text-gray-500 uppercase tracking-widest mb-1">${c.name}</h4><p class="text-3xl font-black mb-6">$${c.price.toLocaleString(undefined, {minimumFractionDigits: 2})}</p>
                    <button class="w-full py-4 bg-primary text-white text-[10px] font-black rounded-2xl uppercase tracking-widest">Execute Trade</button></div>`;
            });
        }

        function syncLeaderboard() {
            db.ref('global_ranking').orderByChild('wallet').limitToLast(10).on('value', snap => {
                const feed = document.getElementById('leader-feed');
                feed.innerHTML = '';
                let d = []; snap.forEach(c => d.push(c.val()));
                d.reverse().forEach((u, i) => {
                    feed.innerHTML += `<div class="flex justify-between items-center p-5 glass rounded-3xl border border-white/5 shadow-lg">
                        <div class="flex items-center gap-5"><span class="text-xl font-black ${i < 3 ? 'text-primary' : 'text-gray-700'}">#${i+1}</span>
                        <div><p class="font-bold text-sm text-white">${u.name}</p><p class="text-[9px] text-gray-500 font-bold uppercase">Pro Trader</p></div></div>
                        <p class="text-lg font-black neon-glow">$${u.wallet.toLocaleString()}</p></div>`;
                });
            });
        }

        // --- SETTINGS CONFIG ---
        function openSettings() { document.getElementById('modal-settings').classList.remove('hidden'); }
        function closeSettings() { document.getElementById('modal-settings').classList.add('hidden'); }
        function saveSettings() {
            const k = document.getElementById('cfg-key').value;
            const m = document.getElementById('cfg-model').value;
            const n = document.getElementById('cfg-name').value;
            if(k) { state.cfg.key = k; localStorage.setItem('ay_key', k); }
            if(m) { state.cfg.model = m; localStorage.setItem('ay_model', m); }
            if(n) { state.p.name = n; updateHUD(); }
            closeSettings();
            addAI("System Handshake Complete. AI Model updated to: **" + state.cfg.model + "**.");
        }

        document.getElementById('ai-send').onclick = triggerAI;
        document.getElementById('ai-input').onkeypress = (e) => { if(e.key === 'Enter') triggerAI(); };
    </script>
</body>
</html>
