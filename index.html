<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Coin AI Simulator Pro | OfficialAyanEdits</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #22c55e;
            --primary-dark: #166534;
            --bg: #030712;
            --card-bg: rgba(17, 24, 39, 0.7);
            --border: rgba(255, 255, 255, 0.08);
            --accent: #f59e0b;
        }

        /* Base Setup */
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg);
            color: #f3f4f6;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .terminal-text { font-family: 'JetBrains Mono', monospace; }

        /* Custom Glassmorphism */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            border: 1px solid var(--border);
        }

        .neon-border-green { border: 1px solid var(--primary); box-shadow: 0 0 15px rgba(34, 197, 94, 0.2); }
        .neon-border-gold { border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(245, 158, 11, 0.2); }
        .neon-text-green { color: var(--primary); text-shadow: 0 0 8px rgba(34, 197, 94, 0.4); }

        /* Animations */
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scanline { 0% { top: -100%; } 100% { top: 100%; } }

        .animate-slide { animation: slideUp 0.4s ease-out forwards; }
        .animate-fade { animation: fadeIn 0.3s ease-in forwards; }

        .scanline::before {
            content: "";
            position: absolute;
            width: 100%;
            height: 2px;
            background: rgba(34, 197, 94, 0.05);
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 100;
        }

        /* Component Styles */
        .tab-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .tab-btn.active { background: var(--primary); color: white; box-shadow: 0 0 15px rgba(34, 197, 94, 0.4); }
        
        .chat-container::-webkit-scrollbar { width: 4px; }
        .chat-container::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.1); border-radius: 10px; }

        .input-glow:focus { box-shadow: 0 0 20px rgba(34, 197, 94, 0.15); border-color: var(--primary); }
        
        /* Mobile Safety */
        @media (max-width: 640px) {
            .mobile-full { height: 100vh; height: -webkit-fill-available; }
        }
    </style>
</head>
<body class="mobile-full flex flex-col h-screen scanline">

    <div id="startup-overlay" class="fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center p-10 terminal-text">
        <div class="w-full max-w-lg">
            <div id="boot-logs" class="text-green-500 text-xs space-y-1 mb-8">
                <p>> BOOT_VERSION: 2.0.4_STABLE</p>
                <p>> KERNEL: AYAN_EDITS_TYCOON_ENGINE</p>
                <p>> FIREBASE_CONNECTION: ESTABLISHING...</p>
                <p>> LOCAL_WALLET: LOADED</p>
            </div>
            <div class="h-1 w-full bg-white/5 rounded-full overflow-hidden">
                <div id="boot-progress" class="h-full bg-green-500 w-0 transition-all duration-300"></div>
            </div>
            <p id="boot-status" class="mt-4 text-[10px] text-gray-500 uppercase tracking-widest text-center">Decrypting Assets...</p>
        </div>
    </div>

    <header class="glass sticky top-0 z-50 px-6 py-4 flex flex-col md:flex-row justify-between items-center gap-4 border-b border-white/5">
        <div class="flex items-center gap-4 w-full md:w-auto">
            <div class="relative group">
                <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-green-500 to-emerald-800 flex items-center justify-center font-black text-white text-xl shadow-lg border border-white/20 group-hover:scale-110 transition-transform">A</div>
                <div class="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 border-2 border-[#030712] rounded-full animate-pulse"></div>
            </div>
            <div>
                <div class="flex items-center gap-2">
                    <h2 id="p-handle" class="font-extrabold text-lg tracking-tight">AYAN_GUEST</h2>
                    <span id="p-badge" class="bg-primary/20 text-primary text-[9px] px-2 py-0.5 rounded font-black uppercase border border-primary/30">Newbie</span>
                </div>
                <div class="flex items-center gap-3 text-[10px] text-gray-500 font-bold uppercase tracking-widest">
                    <span>Rank: <span id="p-rank" class="text-white">#--</span></span>
                    <span class="w-1 h-1 bg-gray-700 rounded-full"></span>
                    <span>Streak: <span id="p-streak-text" class="text-white">0 Days</span></span>
                </div>
            </div>
        </div>

        <div class="flex items-center gap-6 w-full md:w-auto justify-between md:justify-end">
            <div class="text-right">
                <p class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Net Profit / Loss</p>
                <p id="p-profit" class="text-xs font-bold text-green-400">+$0.00</p>
            </div>
            <div class="px-5 py-3 rounded-2xl bg-white/5 border border-white/10 flex flex-col items-end">
                <p class="text-[9px] text-gray-500 font-bold uppercase tracking-widest">Available Capital</p>
                <p id="p-wallet" class="text-2xl font-black neon-text-green">$0.00</p>
            </div>
        </div>
    </header>

    <nav class="flex justify-around p-2 glass border-b border-white/5 gap-2">
        <button onclick="switchTab('chat')" id="btn-chat" class="tab-btn active flex-grow py-3 rounded-xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Manager
        </button>
        <button onclick="switchTab('market')" id="btn-market" class="tab-btn flex-grow py-3 rounded-xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Market
        </button>
        <button onclick="switchTab('jobs')" id="btn-jobs" class="tab-btn flex-grow py-3 rounded-xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Job Board
        </button>
        <button onclick="switchTab('leaderboard')" id="btn-leaderboard" class="tab-btn flex-grow py-3 rounded-xl text-[10px] font-black uppercase tracking-widest flex flex-col items-center text-gray-500">
            <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Ranking
        </button>
    </nav>

    <main class="flex-grow relative overflow-hidden">
        
        <section id="view-chat" class="absolute inset-0 flex flex-col">
            <div id="chat-messages" class="flex-grow overflow-y-auto p-6 space-y-6 chat-container">
                <div class="animate-slide">
                    <div class="max-w-[85%] bg-white/5 border-l-4 border-green-500 p-5 rounded-2xl rounded-tl-none glass shadow-xl">
                        <p class="text-[10px] font-bold text-green-500 uppercase mb-2">System Message</p>
                        <p class="text-sm leading-relaxed">
                            Welcome back, Boss. Terminal v2.0 is live. I have verified your credentials. Your capital is safe.
                            <br><br>
                            How can I assist you today? 
                            <br>‚Ä¢ Type <b class="text-white">/create</b> to launch a blockchain.
                            <br>‚Ä¢ Type <b class="text-white">/profile</b> to see detailed stats.
                            <br>‚Ä¢ Type <b class="text-white">/settings</b> to update API config.
                        </p>
                    </div>
                </div>
            </div>

            <div class="p-6 bg-gradient-to-t from-bg via-bg/90 to-transparent">
                <div class="max-w-4xl mx-auto relative">
                    <div id="typing-indicator" class="hidden absolute -top-8 left-4 text-[9px] text-green-500 font-bold uppercase tracking-widest animate-pulse">AI Manager is analyzing...</div>
                    <div class="glass p-1.5 rounded-2xl border border-white/10 flex items-center shadow-2xl input-glow">
                        <input type="text" id="user-input" placeholder="Enter command or message..." class="flex-grow bg-transparent px-5 py-4 outline-none text-sm font-medium placeholder:text-gray-600">
                        <button id="send-btn" class="bg-primary hover:bg-emerald-500 text-white p-4 rounded-xl transition-all shadow-lg active:scale-95">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M5 12h14M12 5l7 7-7 7" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <section id="view-market" class="absolute inset-0 hidden overflow-y-auto p-6 space-y-6 bg-[#020617]">
            <div class="flex justify-between items-end">
                <h3 class="text-2xl font-black tracking-tighter">LIVE MARKET</h3>
                <p class="text-[10px] text-gray-500 font-bold uppercase">Updates every 60s</p>
            </div>
            <div id="market-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="glass p-5 rounded-3xl border border-white/5 animate-fade">
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center text-green-500 font-bold border border-green-500/20">AO</div>
                        <div class="text-right"><p class="text-xs text-green-400 font-black">+4.2%</p><p class="text-[9px] text-gray-500">24H CHANGE</p></div>
                    </div>
                    <h4 class="font-bold text-white mb-1">Ayan Official</h4>
                    <p class="text-2xl font-black neon-text-green mb-4">$142.09</p>
                    <button class="w-full py-2 bg-white/5 border border-white/10 rounded-xl text-xs font-bold hover:bg-white/10 transition-colors">TRADE NOW</button>
                </div>
            </div>
        </section>

        <section id="view-jobs" class="absolute inset-0 hidden overflow-y-auto p-6 space-y-6 bg-[#050505]">
            <div class="p-6 rounded-3xl bg-yellow-900/10 border border-yellow-700/20 mb-6">
                <h3 class="text-xl font-bold text-yellow-500 mb-2">Job Board (Bankruptcy Recovery)</h3>
                <p class="text-xs text-gray-400 leading-relaxed">If you are bankrupt, apply for jobs from Top Players. Promote their tokens to earn 5-10% commission on every buy transaction.</p>
            </div>
            <div id="jobs-container" class="space-y-4">
                <div class="text-center py-20 opacity-30 italic text-sm">Waiting for Bosses to post jobs...</div>
            </div>
        </section>

        <section id="view-leaderboard" class="absolute inset-0 hidden overflow-y-auto p-6 space-y-6 bg-[#02040a]">
            <h3 class="text-2xl font-black tracking-tighter text-center mb-8">GLOBAL TOP 100</h3>
            <div class="max-w-2xl mx-auto space-y-2" id="leader-list">
                </div>
        </section>

    </main>

    <div id="modal-settings" class="fixed inset-0 z-[150] bg-black/95 hidden items-center justify-center p-6 backdrop-blur-xl">
        <div class="glass p-8 rounded-[2rem] w-full max-w-lg border border-primary/20 animate-slide">
            <h3 class="text-2xl font-black mb-2">TERMINAL CONFIG</h3>
            <p class="text-xs text-gray-500 mb-8 uppercase tracking-widest font-bold">Secure Hardware Access</p>
            
            <div class="space-y-6">
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-2 block">OpenRouter API Key</label>
                    <input type="password" id="set-api-key" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-primary transition-all text-sm" placeholder="sk-or-v1-...">
                </div>
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-2 block">Player Handle (Name)</label>
                    <input type="text" id="set-handle" class="w-full bg-white/5 border border-white/10 p-4 rounded-2xl outline-none focus:border-primary transition-all text-sm" placeholder="@Ayan_Edits">
                </div>
                <div>
                    <label class="text-[10px] text-primary font-black uppercase mb-2 block">Model Selection</label>
                    <select id="set-model" class="w-full bg-[#111827] border border-white/10 p-4 rounded-2xl outline-none focus:border-primary transition-all text-sm appearance-none">
                        <option value="deepseek/deepseek-r1:free">DeepSeek R1 (Fast Free)</option>
                        <option value="google/gemini-pro-1.5-exp">Gemini Pro 1.5</option>
                    </select>
                </div>
                <button onclick="saveSettings()" class="w-full bg-primary hover:bg-emerald-500 py-4 rounded-2xl font-black text-sm uppercase tracking-widest shadow-lg shadow-primary/20 transition-all active:scale-95 mt-4">Save & Establish Link</button>
                <button onclick="closeSettings()" class="w-full py-2 text-xs text-gray-600 font-bold uppercase hover:text-white transition-colors">Dismiss</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. FIREBASE & CORE INIT ---
        const firebaseConfig = {
            apiKey: "AIzaSyAAC-fGe6dO1nIQ1LCg7f-Bk-spQ2IAvEs",
            authDomain: "tubevideo-d3bf7.firebaseapp.com",
            databaseURL: "https://tubevideo-d3bf7-default-rtdb.firebaseio.com",
            projectId: "tubevideo-d3bf7",
            storageBucket: "tubevideo-d3bf7.firebasestorage.app",
            messagingSenderId: "327518146396",
            appId: "1:327518146396:web:e88298f8f049fdb73ebb99"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        // --- 2. GAME STATE MANAGEMENT ---
        let state = {
            player: {
                handle: localStorage.getItem('ay_handle') || "AYAN_GUEST",
                wallet: parseFloat(localStorage.getItem('ay_wallet')) || 1000.00,
                streak: parseInt(localStorage.getItem('ay_streak')) || 0,
                lastClaim: parseInt(localStorage.getItem('ay_last_claim')) || 0,
                rank: "ROOKIE",
                isBankrupt: false,
                profit: 0
            },
            market: [
                { id: 'ao', name: 'Ayan Official', price: 142.09, change: 4.2, color: 'green' },
                { id: 'ac', name: 'A Coin', price: 0.85, change: -1.2, color: 'red' }
            ],
            currentTab: 'chat',
            apiKey: localStorage.getItem('ay_apikey') || '',
            model: localStorage.getItem('ay_model') || 'deepseek/deepseek-r1:free'
        };

        // --- 3. SYSTEM BOOTING ---
        window.onload = () => {
            const progress = document.getElementById('boot-progress');
            const status = document.getElementById('boot-status');
            
            let p = 0;
            const interval = setInterval(() => {
                p += Math.random() * 20;
                if(p >= 100) {
                    p = 100;
                    clearInterval(interval);
                    setTimeout(finishBoot, 500);
                }
                progress.style.width = p + '%';
                if(p > 30) status.innerText = "Connecting to Firebase Clusters...";
                if(p > 70) status.innerText = "Syncing Market Liquidity...";
            }, 100);
        };

        function finishBoot() {
            document.getElementById('startup-overlay').classList.add('animate-fade');
            setTimeout(() => {
                document.getElementById('startup-overlay').classList.add('hidden');
                initGame();
            }, 300);
        }

        // --- 4. CORE ENGINE LOGIC ---
        function initGame() {
            updateHUD();
            check7DayReward();
            syncLeaderboard();
            startMarketSimulation();
            
            if(!state.apiKey) {
                openSettings();
                addSystemMessage("CRITICAL: API Key missing. Terminal functionality limited.");
            }
        }

        function updateHUD() {
            const walletEl = document.getElementById('p-wallet');
            walletEl.innerText = `$${state.player.wallet.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            document.getElementById('p-handle').innerText = state.player.handle.toUpperCase();
            document.getElementById('p-streak-text').innerText = `${state.player.streak} Days`;
            
            if(state.player.wallet <= 0) {
                state.player.isBankrupt = true;
                walletEl.classList.add('text-red-500');
                walletEl.classList.remove('neon-text-green');
            } else {
                state.player.isBankrupt = false;
                walletEl.classList.remove('text-red-500');
                walletEl.classList.add('neon-text-green');
            }

            // Save Progress
            localStorage.setItem('ay_wallet', state.player.wallet);
            localStorage.setItem('ay_handle', state.player.handle);
            
            // Sync Firebase
            db.ref('users/' + state.player.handle.replace(/[^a-zA-Z0-9]/g, '')).set({
                handle: state.player.handle,
                wallet: state.player.wallet,
                rank: state.player.rank,
                lastSeen: Date.now()
            });
        }

        function check7DayReward() {
            const now = Date.now();
            const oneDay = 24 * 60 * 60 * 1000;
            if(now - state.player.lastClaim > oneDay) {
                state.player.streak = (state.player.streak >= 7) ? 1 : state.player.streak + 1;
                const reward = state.player.streak * 1000;
                state.player.wallet += reward;
                state.player.lastClaim = now;
                
                localStorage.setItem('ay_streak', state.player.streak);
                localStorage.setItem('ay_last_claim', now);
                
                addSystemMessage(`üèÜ REWARD: Day ${state.player.streak} Login! +$${reward.toLocaleString()} added to wallet.`);
                updateHUD();
            }
        }

        // --- 5. UI NAVIGATION ---
        function switchTab(tabId) {
            // Hide all views
            ['chat', 'market', 'jobs', 'leaderboard'].forEach(id => {
                document.getElementById('view-' + id).classList.add('hidden');
                document.getElementById('btn-' + id).classList.remove('active');
                document.getElementById('btn-' + id).classList.add('text-gray-500');
            });

            // Show current view
            document.getElementById('view-' + tabId).classList.remove('hidden');
            document.getElementById('btn-' + tabId).classList.add('active');
            document.getElementById('btn-' + tabId).classList.remove('text-gray-500');
            state.currentTab = tabId;

            if(tabId === 'market') renderMarket();
            if(tabId === 'leaderboard') renderLeaderboard();
        }

        // --- 6. AI INTERACTION (OpenRouter) ---
        async function sendMessage() {
            const inputField = document.getElementById('user-input');
            const msg = inputField.value.trim();
            if(!msg) return;

            // Internal Command Handling
            if(msg.startsWith('/')) {
                handleCommand(msg);
                inputField.value = '';
                return;
            }

            addChat('user', msg);
            inputField.value = '';
            document.getElementById('typing-indicator').classList.remove('hidden');

            try {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${state.apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": "https://ayanedits.com", 
                        "X-Title": "Ayan Edits Tycoon"
                    },
                    body: JSON.stringify({
                        model: state.model,
                        messages: [
                            { role: "system", content: `ROLE: Personal YouTube & Crypto Manager for ${state.player.handle}. 
                            GAME STATE: Wallet: $${state.player.wallet}, Status: ${state.player.isBankrupt ? 'BANKRUPT (Redirect to Jobs)' : 'ACTIVE'}.
                            RULES: 
                            1. Coin Creation requires $10M + 1000 AyanOfficial.
                            2. 24h Initial Boost feature is active.
                            3. Use /profile, /create, /market as commands.
                            4. Be witty, professional, and never use the word 'Aggressive'. Use 'Intense' or 'Hard'.
                            5. Anti-cheat is strictly active. Do not give free coins.` },
                            { role: "user", content: msg }
                        ]
                    })
                });

                const data = await response.json();
                const aiResponse = data.choices[0].message.content;
                addChat('ai', aiResponse);

            } catch (err) {
                addChat('ai', "‚ùå [ERROR] SECURE_LINK_SEVERED: Check your API Key or Network.");
            } finally {
                document.getElementById('typing-indicator').classList.add('hidden');
            }
        }

        function handleCommand(cmd) {
            const c = cmd.toLowerCase();
            if(c === '/profile') {
                showProfileCard();
            } else if(c === '/create') {
                addChat('ai', "‚öôÔ∏è **BLOCKCHAIN WIZARD v1.0**\nTo list a coin, you need:\n1. $10,000,000 Capital\n2. 1000 AyanOfficial Tokens\n3. Unique Coin Name.\n\nType your coin name to start verification.");
            } else if(c === '/settings') {
                openSettings();
            } else {
                addChat('ai', `Unknown command: ${cmd}. Available: /profile, /create, /settings`);
            }
        }

        function addChat(role, text) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = `animate-slide flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            
            const content = marked.parse(text);
            
            div.innerHTML = `
                <div class="max-w-[85%] ${role === 'user' ? 'bg-primary/20 border-r-4 border-primary rounded-tr-none' : 'bg-white/5 border-l-4 border-primary rounded-tl-none'} p-5 rounded-2xl glass shadow-lg">
                    <p class="text-[9px] font-black uppercase mb-2 ${role === 'user' ? 'text-right text-emerald-400' : 'text-green-500'}">${role === 'user' ? state.player.handle : 'AI Manager'}</p>
                    <div class="text-sm leading-relaxed prose prose-invert max-w-none">${content}</div>
                </div>
            `;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function showProfileCard() {
            const profile = `
                <div class="p-6 rounded-3xl bg-gradient-to-br from-white/10 to-transparent border border-white/10 shadow-2xl">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-black text-white">DOSSIER: ${state.player.handle}</h3>
                        <span class="text-[10px] bg-green-500 text-black px-3 py-1 rounded-full font-black">${state.player.rank}</span>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between border-b border-white/5 pb-2">
                            <span class="text-xs text-gray-500 font-bold">Liquid Balance</span>
                            <span class="text-xs font-bold text-green-400">$${state.player.wallet.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between border-b border-white/5 pb-2">
                            <span class="text-xs text-gray-500 font-bold">Daily Streak</span>
                            <span class="text-xs font-bold text-white">${state.player.streak} Days</span>
                        </div>
                        <div class="flex justify-between border-b border-white/5 pb-2">
                            <span class="text-xs text-gray-500 font-bold">Account Status</span>
                            <span class="text-xs font-bold ${state.player.isBankrupt ? 'text-red-500' : 'text-green-500'}">${state.player.isBankrupt ? 'BANKRUPT' : 'OPERATIONAL'}</span>
                        </div>
                    </div>
                </div>
            `;
            addChat('ai', profile);
        }

        function addSystemMessage(text) {
            const container = document.getElementById('chat-messages');
            const div = document.createElement('div');
            div.className = "flex justify-center my-4 animate-fade";
            div.innerHTML = `<span class="bg-white/5 text-[9px] text-gray-400 px-4 py-1.5 rounded-full border border-white/5 font-black uppercase tracking-widest">${text}</span>`;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        // --- 7. MARKET SIMULATOR ---
        function startMarketSimulation() {
            setInterval(() => {
                state.market.forEach(coin => {
                    const change = (Math.random() * 4) - 2;
                    coin.price += (coin.price * (change/100));
                    coin.change = change.toFixed(2);
                });
                if(state.currentTab === 'market') renderMarket();
            }, 5000);
        }

        function renderMarket() {
            const grid = document.getElementById('market-grid');
            grid.innerHTML = '';
            state.market.forEach(coin => {
                const card = document.createElement('div');
                card.className = "glass p-6 rounded-3xl border border-white/5 animate-fade hover:border-primary/30 transition-all";
                card.innerHTML = `
                    <div class="flex justify-between items-start mb-4">
                        <div class="w-12 h-12 rounded-2xl bg-white/5 flex items-center justify-center text-xl font-black border border-white/10">${coin.id.toUpperCase()}</div>
                        <div class="text-right">
                            <p class="text-sm font-black ${coin.change >= 0 ? 'text-green-400' : 'text-red-400'}">${coin.change >= 0 ? '+' : ''}${coin.change}%</p>
                            <p class="text-[9px] text-gray-500 font-bold uppercase">Volatility</p>
                        </div>
                    </div>
                    <h4 class="text-sm font-bold text-gray-400 uppercase tracking-widest mb-1">${coin.name}</h4>
                    <p class="text-2xl font-black text-white mb-6">$${coin.price.toLocaleString(undefined, {minimumFractionDigits: 2})}</p>
                    <div class="flex gap-2">
                        <button class="flex-grow py-3 bg-primary text-white text-[10px] font-black rounded-xl uppercase tracking-widest shadow-lg shadow-primary/20">Buy</button>
                        <button class="flex-grow py-3 bg-white/5 border border-white/10 text-white text-[10px] font-black rounded-xl uppercase tracking-widest">Sell</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- 8. LEADERBOARD SYNC ---
        function syncLeaderboard() {
            db.ref('users').orderByChild('wallet').limitToLast(10).on('value', (snap) => {
                state.leaderboard = [];
                snap.forEach(child => {
                    state.leaderboard.push(child.val());
                });
                state.leaderboard.reverse();
                if(state.currentTab === 'leaderboard') renderLeaderboard();
            });
        }

        function renderLeaderboard() {
            const list = document.getElementById('leader-list');
            list.innerHTML = '';
            state.leaderboard.forEach((user, i) => {
                const row = document.createElement('div');
                row.className = "flex justify-between items-center p-4 glass rounded-2xl border border-white/5 hover:border-primary/20 transition-all";
                row.innerHTML = `
                    <div class="flex items-center gap-4">
                        <span class="text-lg font-black ${i < 3 ? 'text-primary' : 'text-gray-600'}">#${i + 1}</span>
                        <div>
                            <p class="font-bold text-sm">${user.handle}</p>
                            <p class="text-[9px] text-gray-500 uppercase font-black tracking-widest">${user.rank || 'ROOKIE'}</p>
                        </div>
                    </div>
                    <p class="text-sm font-black neon-text-green">$${user.wallet.toLocaleString()}</p>
                `;
                list.appendChild(row);
            });
        }

        // --- 9. SETTINGS MANAGEMENT ---
        function openSettings() {
            document.getElementById('modal-settings').classList.remove('hidden');
            document.getElementById('modal-settings').classList.add('flex');
            document.getElementById('set-api-key').value = state.apiKey;
            document.getElementById('set-handle').value = state.player.handle;
            document.getElementById('set-model').value = state.model;
        }

        function closeSettings() {
            document.getElementById('modal-settings').classList.add('hidden');
            document.getElementById('modal-settings').classList.remove('flex');
        }

        function saveSettings() {
            const key = document.getElementById('set-api-key').value.trim();
            const handle = document.getElementById('set-handle').value.trim();
            const model = document.getElementById('set-model').value;

            if(key) {
                state.apiKey = key;
                localStorage.setItem('ay_apikey', key);
            }
            if(handle) {
                state.player.handle = handle;
                localStorage.setItem('ay_handle', handle);
            }
            state.model = model;
            localStorage.setItem('ay_model', model);

            updateHUD();
            closeSettings();
            addSystemMessage("Terminal Configuration Updated. Handshake Secure.");
        }

        // --- 10. EVENT LISTENERS ---
        document.getElementById('send-btn').addEventListener('click', sendMessage);
        document.getElementById('user-input').addEventListener('keypress', (e) => {
            if(e.key === 'Enter') sendMessage();
        });

    </script>
</body>
</html>
